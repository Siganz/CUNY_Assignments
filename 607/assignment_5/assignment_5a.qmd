---
title: "assignment_5a"
format: html
toc: true
toc-depth: 5
toc-location: left
---

```{r}
library(tidyverse)
library(ggthemes)
```

## Approach

I should be able to recreate this table.

```{r}
df <- tibble(
  airline = c("", "ALASKA", "", "", "AM WEST",""),
  status  = c("", "on time", "delayed", "", "on time", "delayed"),
  city_1 = c("Los Angeles", 497, 62, " ", 694, 117),
  city_2 = c("Phoenix", 221, 12, " ", 4840, 415),
  city_3 = c("San Diego", 212, 20, " ", 383, 65),
  city_4 = c("San Francisco", 503, 102, " ", 320, 129),
  city_5 = c("Seattke", 1841, 305, " ", 201, 61)
)
df
```

I didn't read the instructions, says I need to create a csv, so I'll do that and then read it into R.

```{r}
url <- "https://raw.githubusercontent.com/Siganz/CUNY_Assignments/9692d867a6a7bdf9bf986be51a0bbeab0a4f7ef5/607/assignment_5/weird_table.csv"
df <- tibble(read_csv(url))
df
```

![weird table](https://raw.githubusercontent.com/Siganz/CUNY_Assignments/refs/heads/main/607/assignment_5/weird_table.png)

*Submitted data file with at least some count analysis (+45)*
Ok, so we can do a count of total flights, count of flights per location, counts of flights per airline. 

*Recreated File in Same Format as given, including missing data where there were empty cells in source data. (+5)*
I recreated the table in excel, formatted it into a csv with the empty fields. So we are ok on that.

*Placed file in Internet-accessible location, such as a publicly-accessible GitHub repo.  Also OK (if less scaleable) to generated and populated dataframe from code. (+5)*
I placed it into my folder and called it via cwd, so this should work fine.

*Provided code to populate missing data. (+5)*
Populate missing data? Oh, maybe he wants us to do a Global Baseline Estimate for the missing row? Probably not. Maybe just to `fill(x, .direction = "down")` down the airline field. 

*Transformed data from wide to long format. (+10)*
Ok, so `pivot_longer()` to combine all the cities into one column called `cities` with their values to `time`. That way we have airline, flights, and times. 

*Compared percentage (not just counts) of either delays or arrival rates for two airlines overall. [Either with a chart, or a table; both would be exemplary].  Include text summarizes findings from this comparison. (+10)*

We can get the total then divide the total by the sum of delayed * 100 to get the percentage. We can do a `filter` choosing either delay or arrival, get the total, get the percentage of delayed flights per airline using `summarization()`. 

*Compared percentage (not just counts) of either delays or arrival rates for two airlines across five cities. [Either with a chart, or a table; both would be exemplary].  Include text summarizes findings from this comparison. (+10)*

Same thing as the previous, we would just summarize by airline, city. However, it makes sense to widen flights. 

*Describe discrepancy between comparing two airlinesâ€™ flight performances city-by-city and overall. (+5)*

Summarize by carrier & cities. 

### Codebase

```{r}
df2 <- df |>
  rename(airline = ...1, status = ...2) |>
  filter(!is.na(status)) |>
  fill(airline, .direction = "down") |>
  pivot_longer(c("Los Angeles", "Phoenix", "San Diego", "San Francisco", "Seattle"), names_to = "city", values_to = "flights")

# Some quick stats
glue::glue("Total flights:\n",sum(df2$flights))
df2 |> group_by(airline, city) |> summarize(total_flights = sum(flights)) |> arrange(airline, city)

df3 <- df2|>
  group_by(airline, status) |>
  summarize(flights = sum(flights, na.rm = TRUE), .groups = "drop") |>
  group_by(airline) |>
  mutate(total = sum(flights, na.rm = TRUE), perc = 100 * flights / total) |>
  ungroup()

df3
df3 |> filter(status == "delayed")|> 
  ggplot(aes(airline, perc, fill = airline)) + 
  geom_col(width = 0.6) +
  geom_text(aes(label = glue::glue("{round(perc, 2)}%")), position = position_nudge(y = 0.8)) +
  labs(title = "Airline % Delayed",
       x = "Airline",
       y = "Percentage Total") +
  theme_fivethirtyeight()

df3 |> filter(status == "on time")|> 
  ggplot(aes(airline, perc, fill = airline)) + 
  geom_col(width = 0.6) +
  geom_text(aes(label = glue::glue("{round(perc, 2)}%")), position = position_nudge(y = 3.5)) +
  labs(title = "Airline % On Time",
       x = "Airline",
       y = "Percentage Total") +
  theme_fivethirtyeight()
```

```{r}
df4 <- df2|>
  group_by(airline, status, city) |>
  summarize(flights = sum(flights, na.rm = TRUE), .groups = "drop") |>
  group_by(airline, city) |>
  mutate(total = sum(flights, na.rm = TRUE), perc = 100 * flights / total) |>
  ungroup()

df5 <- df4 |>
  filter(status == "delayed") |>
  ggplot(aes(x = city, y = perc, fill = airline)) +
  geom_col(width = 0.6) +
  geom_text(aes(label = glue::glue("{round(perc, 2)}%")), size = 3, position = position_stack(vjust = 0.5)) +
  labs(title = "Airline % Delayed per City",
       x = "Airline",
       y = "Percentage Total") +
  scale_color_fivethirtyeight() +
  theme_fivethirtyeight()

df6 <- df4 |>
  filter(status == "on time") |>
  ggplot(aes(x = city, y = perc, fill = airline)) +
  geom_col(width = 0.6) +
  geom_text(aes(label = glue::glue("{round(perc, 2)}%")), size = 3, position = position_stack(vjust = 0.5)) +
  labs(title = "Airline % On Time per City",
       x = "Airline",
       y = "Percentage Total") +
  scale_color_fivethirtyeight() +
  theme_fivethirtyeight()

```


```{r}
df4 |>
  filter(status == "delayed")
df5
```
Above shows the ggplot for delays as a percentage of the total flights per airline per city. Overall, seems that AM WEST has higher % of their flights being delayed when compared to Alaska. especially in San Francisco and Seattle. 

```{r}
df4 |>
  filter(status == "on time")
df6
```
In the ggplot above, we are looking at on time flights as a percentage of the total flights per city. Similar to the above, we can see that Alaska has a higher % of their flights being on time when compared to AM West. 

```{r}
df3 |>
  select(airline, total) |>
  group_by(airline) |>
  summarize(airline_total = sum(total)/2) |>
  ungroup() |>
  mutate(total_flights = sum(airline_total), percentage = (airline_total/total_flights) * 100)

df3 |> filter(status == "delayed")|> 
  ggplot(aes(airline, perc, fill = airline)) + 
  geom_col(width = 0.6) +
  geom_text(aes(label = glue::glue("{round(perc, 2)}%")), position = position_nudge(y = 0.8)) +
  labs(title = "Airline % Delayed",
       x = "Airline",
       y = "Percentage Total") +
  theme_fivethirtyeight()

```
However, we should remember that AM WEST accounts for 65% of all total flights, with Alaska at 35%, so while Alaska performs better per city, AM WEST has a higher count of flights that are on time. 